<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Scientific Library (DSL)</title>
  <style>
    body {
      background-color: #0b0c10;
      color: #eaeaea;
      font-family: sans-serif;
      padding: 2em;
    }
    h1 { color: #66fcf1; }
    pre {
      background: #1f2833;
      padding: 1em;
      border-radius: 5px;
      overflow-x: auto;
      max-height: 400px;
    }
    a { color: #45a29e; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .file { margin-left: 1em; }
    button {
      background-color: #45a29e;
      color: #0b0c10;
      border: none;
      padding: 0.5em 1em;
      margin-top: 0.5em;
      cursor: pointer;
    }
    textarea {
      width: 100%;
      max-width: 600px;
      height: 100px;
      background: #1f2833;
      color: #66fcf1;
      border: 1px solid #45a29e;
      padding: 0.5em;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>üìö Digital Scientific Library</h1>

  <section>
    <h2>Browse Repository</h2>
    <div id="fileViewer">Loading files...</div>
  </section>

  <section style="margin-top: 2em;">
    <h2>üîç Add Scraping Keywords</h2>
    <p>Enter scientific keywords to auto-scrape new content via GitHub Action:</p>
    <textarea id="keywords" placeholder="e.g. fusion, dark matter, CRISPR..."></textarea><br>
    <button onclick="saveKeywords()">Save Keywords</button>
  </section>

  <script>
    const username = "purpleparrotpartpradime";
    const repo = "DSL-Digital-Scientific-Library-.GitHub.engine.io.dsl.mdot";
    const API_BASE = `https://api.github.com/repos/${username}/${repo}/contents/`;
    const headers = {
      "Authorization": "token REPLACE_WITH_YOUR_PAT_IF_RUNNING_LOCALLY",
      "Accept": "application/vnd.github.v3+json"
    };

    async function loadFiles(path = "") {
      try {
        const res = await fetch(API_BASE + path, { headers });
        const files = await res.json();
        const viewer = document.getElementById("fileViewer");
        if (path === "") viewer.innerHTML = "";
        const ul = document.createElement("ul");
        for (const file of files) {
          const li = document.createElement("li");
          if (file.type === "dir") {
            li.innerHTML = `<strong> ${file.name}</strong>`;
            li.onclick = () => loadFiles(file.path);
          } else {
            li.innerHTML = `<a href="${file.download_url}" target="_blank">${file.name}</a>`;
          }
          ul.appendChild(li);
        }
        if (path !== "") {
          const back = document.createElement("li");
          back.innerHTML = `<a href="#">Back</a>`;
          back.onclick = () => loadFiles(path.split("/").slice(0, -1).join("/"));
          ul.prepend(back);
        }
        viewer.appendChild(ul);
      } catch (e) {
        console.error("Error loading files:", e);
      }
    }

    async function saveKeywords() {
      const keywords = document.getElementById("keywords").value.trim();
      if (!keywords) return;
      const content = btoa(keywords);
      const path = "config/keywords.txt";

      try {
        const existing = await fetch(API_BASE + path, { headers }).then(r => r.ok ? r.json() : null);
        const sha = existing?.sha;

        const method = "PUT";
        const body = {
          message: sha ? "Update keywords" : "Create keywords",
          content,
          ...(sha && { sha })
        };

        const res = await fetch(API_BASE + path, {
          method,
          headers,
          body: JSON.stringify(body)
        });

        if (res.ok) {
          console.log(" Keywords updated.");
          alert(" Keywords saved!");
        } else {
          console.error("Failed to save:", await res.text());
        }
      } catch (err) {
        console.error("Error saving keywords:", err);
      }
    }

    loadFiles();
  </script>
</body>
</html>
